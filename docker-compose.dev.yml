# Development Docker Compose
# Per PRD: Dev compose file with pnpm install, build, start

version: '3.8'

services:
  # Backend API Server
  server:
    build:
      context: ./packages/server
      dockerfile: Dockerfile.dev
    container_name: field-study-server-dev
    ports:
      - "4000:4000"
    volumes:
      # Mount source code for hot reload
      - ./packages/server/src:/app/src
      - ./packages/server/uploads:/app/uploads
      # SQLite database volume
      - server-data:/app/data
    environment:
      - NODE_ENV=development
      - PORT=4000
      - DB_PATH=/app/data/database.sqlite
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - POSTHOG_API_KEY=${POSTHOG_API_KEY}
      - POSTHOG_HOST=${POSTHOG_HOST:-https://app.posthog.com}
      - ADMIN_EMAILS=${ADMIN_EMAILS}
    networks:
      - app-network
    restart: unless-stopped

  # Client (Optional - can run separately with Vite)
  # Uncomment if you want to run client in Docker too
  # client:
  #   build:
  #     context: ./packages/client
  #     dockerfile: Dockerfile.dev
  #   container_name: field-study-client-dev
  #   ports:
  #     - "5173:5173"
  #   volumes:
  #     - ./packages/client/src:/app/src
  #   environment:
  #     - VITE_API_URL=http://localhost:4000/graphql
  #   networks:
  #     - app-network
  #   depends_on:
  #     - server

volumes:
  server-data:
    driver: local

networks:
  app-network:
    driver: bridge


